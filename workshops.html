<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>نموذج طلب تدريب وحجز ورشة العمل</title>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      direction: rtl;
      background: #f4f7fb;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: linear-gradient(90deg, #004080, #0066cc);
      padding: 20px;
      text-align: right;
      color: #fff;
    }
    header img {
      width: 130px;
      display: inline-block;
      margin-left: 15px;
      vertical-align: middle;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h2 {
      color: #004080;
      margin-bottom: 20px;
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .agreement-box {
      max-height: 350px;
      overflow-y: auto;
      background: #f0f8ff;
      border: 1px solid #ccc;
      padding: 15px;
      margin: 15px 0;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.8;
    }
    input[type="checkbox"] {
      transform: scale(1.5);
      margin-left: 10px;
    }
    button {
      padding: 14px 22px;
      background: linear-gradient(90deg,#0066cc,#004080);
      border: none;
      color: #fff;
      font-size: 17px;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 15px;
      width: 100%;
      transition: transform 0.2s, box-shadow 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    button:hover:enabled {
      transform: scale(1.03);
      box-shadow: 0 6px 15px rgba(0,0,0,0.25);
    }
    .workshop {
      border: 1px solid #ddd;
      padding: 20px;
      margin: 15px 0;
      border-radius: 12px;
      background: #fdfdfd;
      transition: 0.3s;
    }
    .workshop:hover {
      background: #f5faff;
      box-shadow: 0 3px 12px rgba(0,0,0,0.08);
    }
    .workshop h3 {
      color: #004080;
      margin-bottom: 10px;
    }
    .reserved { color: red; font-weight: bold; }
    .available { color: green; font-weight: bold; }
  </style>
</head>
<body>

<header>
  <img src="https://identity.ksu.edu.sa/sites/identity.ksu.edu.sa/files/imce_images/logo_9.png" alt="شعار جامعة الملك سعود">
  <h1>منصة عناوين ورش العمل</h1>
</header>

<div class="container" id="registration">
  <h2>📋 التسجيل والإقرار</h2>
  
  <label>الاسم الثلاثي *</label>
  <input type="text" id="name" required>

  <label>المدينة *</label>
  <input type="text" id="city" required>

  <label>رقم التواصل *</label>
  <input type="text" id="phone" placeholder="05XXXXXXXX" required>

  <label>البريد الإلكتروني *</label>
  <input type="email" id="email" placeholder="example@email.com" required>

  <label>الجهة (اختياري)</label>
  <input type="text" id="organization">

  <div style="background:#eaf4ff; color:#003366; font-size:14px; padding:8px 12px; border-radius:6px; margin:15px 0; font-weight:bold;">
    نأمل منكم التكرم بإرسال صورة شخصية على الإيميل  
    <b>malsehali1.c@KSU.EDU.SA</b>  
    لاستخدامها في شاشات عرض ورش العمل الخاصة بالملتقى
  </div>

  <div class="agreement-box" id="termsBox">
    <img src="HRDF.jpg" alt="شعار صندوق تنمية الموارد البشرية" style="width:120px; float:right; margin:5px 0 10px 10px;">

    <h3 style="color:#004080; text-align:center;">📑 ملتقى التوجيه والإرشاد المهني الأول</h3>
    <h4 style="text-align:center;">التوضيحات والتعليمات الخاصة بإعداد وتقديم حقائب ورش العمل</h4>

<p>حرصا على توحيد مستوى ورش العمل وضمان جودة المخرجات وتحقيق الفائدة المرجوة للمشاركين، نضع بين أيديكم مجموعة من التوضيحات والتعليمات الخاصة بإعداد وتقديم ورش العمل في ملتقى الإرشاد المهني.<br><br>
تهدف هذه الضوابط إلى مساعدة المدربين على الالتزام بالمعايير العلمية والتنظيمية المعتمدة، وتعزيز تجربة المتدربين من خلال محتوى متكامل وأسلوب عرض احترافي.<br><br>
نأمل منكم الاطلاع عليها بعناية والالتزام بما ورد فيها، متمنين لكم التوفيق في إثراء هذا الملتقى بمساهماتكم القيّمة.</p>

<h4>أولاً: توضيحات هامة:</h4>
<ol>
<li>تم اختيار العناوين من قِبل لجنة علمية متخصصة، واعتمدتها الجمعية الوطنية للتطوير المهني.</li>
<li>مدة ورشة العمل لا تقل عن (50) دقيقة ولا تتجاوز (60) دقيقة.</li>
<li>الحد الأقصى لعدد المتدربين في الورشة (15) متدربا.</li>
<li>الفئة المستهدفة: المرشدون المهنيون والمهتمون بالمجال من مختلف القطاعات.</li>
<li>ستقام الورشة في مكان مستقل ومجهز بكافة الأدوات اللازمة للمدرب.</li>
<li>يمنح المدرب شهادة تقدير بعد انتهاء الورشة.</li>
<li>سيتم العرض في شاشه خارجية ( عنوان الورشة ، اسم مقدم الورشة ، صورة مقدم الورشة ).</li>
<li>تخضع الحقيبة التدريبية لمراجعة لجنة الملتقى لضمان اتساقها مع الأهداف والمعايير. مع إتاحة فرصة إبداء الملاحظات أو التعديل عند الحاجة ، دعما للمدربين وتأكيدا على جودة الورش المقدمة .</li>
</ol>

<h4>ثانيا: تعليمات عامة:</h4>
<ol>
<li>جميع العناوين معتمدة باللغة العربية، ويلتزم المدرب باستخدام اللغة العربية في إعداد وتقديم المحتوى.</li>
<li>إنشاء المحتوى مسؤولية المدرب، مع الالتزام بالعنوان والمحاور المحددة للورشة.</li>
<li>يتم إعداد المحتوى باستخدام برنامج PowerPoint.</li>
<li>استخدام لغة واضحة ومناسبة للفئة المستهدفة.</li>
<li>مراعاة التنوع في أساليب العرض والإيضاح.</li>
<li>التنسيق المستمر مع منسق الورشة حول أي تعديل في الأسلوب أو الوقت.</li>
<li>عدم الخروج عن نطاق المحاور المقدمة إلا بموافقة الصندوق.</li>
<li>ضمان أن جميع الأنشطة والأمثلة مرتبطة مباشرة بالمحاور المطلوبة.</li>
<li>مراعاة ثقافة الصندوق والجمهور المستهدف.</li>
<li>الحضور قبل بدء الورشة بوقت كافٍ للتجهيز والتنسيق مع الفريق الفني.</li>
<li>التزام بالمعايير التربوية والتدريبية (وضوح، تسلسل، تفاعل، تقييم).</li>
<li>يُمنع الترويج لأي علامة تجارية أو جهة أو خدمة شخصية إلا بموافقة الصندوق.</li>
<li>التدقيق اللغوي والإملائي للمحتوى قبل إعتماده.</li>
<li>ضرورة التأكد من أن جميع المواد المستخدمة ( صور ، مقاطع ، غيرها) مرخصة او من اعداد المدرب نفسه.</li>
<li>لا يتاح التعديل على محتوى ورشة العمل بعد الاعتماد النهائي </li>
<li>التقديم على المشاركة لا يُعد موافقة نهائية، وسيتم إرسال بريد إلكتروني بتثبيت المشاركة لبدء إعداد المحتوى. التحقق من أن المحتوى علمي وموثق وملائم للفئة المستهدفة.</li>
<li>بعد الورشة، تقديم تقرير يوضح مدى تغطية المحاور، مستوى تفاعل المشاركين، والتوصيات المستقبلية.</li>
</ol>

<p style="margin-top:20px; font-weight:bold; color:#444;">
أقر أنا المدرب/ _____________________________________، بالاطلاع على جميع التعليمات والتوضيحات أعلاه والالتزام التام بما ورد فيها، كما لا أمانع في تصوير ورش العمل الخاصة بي واستخدام محتواها (كليا أو جزئيا) في أي من المنصات أو المواد الإعلامية الخاصة بالملتقى أو الشركاء المنظمين، دون أي التزام مالي أو قانوني تجاه إدارة الملتقى.
</p>

<p style="text-align:center; font-weight:bold; color:#004080;">تمنياتنا لكم بالتوفيق والسداد</p>

<div style="text-align:center; margin-top:15px;">
<button onclick="printTerms()" style="width:auto; background:#008000;">🖨️ طباعة</button>
<button onclick="saveAsPDF()" style="width:auto; background:#0055aa;">💾 حفظ PDF</button>
</div>
</div>

  <div style="text-align:right; margin-top:20px;">
    <label style="display:flex; justify-content:flex-start; align-items:center; gap:10px; font-weight:bold;">
      أقر وأوافق على الشروط والأحكام
      <input type="checkbox" id="agree">
    </label>
  </div>

  <button id="submitBtn" disabled>تسجيل ومتابعة</button>
</div>

<div class="container" id="workshopsContainer" style="display:none;">
  <h2>📝 قائمة عناوين ورش العمل</h2>
  <div id="workshops"></div>
</div>

<script>
function printTerms() {
  const terms = document.getElementById("termsBox").innerHTML;
  const newWin = window.open("");
  newWin.document.write("<html><head><title>الشروط</title></head><body dir='rtl'>" + terms + "</body></html>");
  newWin.print();
  newWin.close();
}
function saveAsPDF() {
  import('https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js')
  .then(() => {
    const element = document.getElementById("termsBox");
    html2pdf().from(element).save("الشروط والأحكام.pdf");
  });
}
</script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getFirestore, collection, doc, updateDoc, onSnapshot, addDoc, getDoc, arrayUnion } 
    from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyCC5Wea1ccPTVNo8nfe2fSv7s6JIKulXTc",
    authDomain: "reservation-system-492d6.firebaseapp.com",
    projectId: "reservation-system-492d6",
    storageBucket: "reservation-system-492d6.appspot.com",
    messagingSenderId: "982147661254",
    appId: "1:982147661254:web:47606a698bd01b5b0746c7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const workshopsRef = collection(db, "workshops");

  let currentUser = null;
  let registered = false;

  const checkbox = document.getElementById("agree");
  const submitBtn = document.getElementById("submitBtn");
  checkbox.addEventListener("change", () => {
    submitBtn.disabled = !checkbox.checked;
  });

  submitBtn.addEventListener("click", async () => {
    const trainer = {
      name: document.getElementById("name").value.trim(),
      city: document.getElementById("city").value.trim(),
      phone: document.getElementById("phone").value.trim(),
      email: document.getElementById("email").value.trim().toLowerCase(),
      organization: document.getElementById("organization").value.trim(),
      approved: true,
      timestamp: new Date()
    };

    if (!trainer.name || !trainer.city || !trainer.phone || !trainer.email) {
      alert("⚠️ الرجاء تعبئة جميع الحقول المطلوبة");
      return;
    }

    await addDoc(collection(db, "trainers"), trainer);
    currentUser = trainer;
    registered = true;
    alert("✅ تم التسجيل بنجاح.");
    document.getElementById("registration").style.display = "none";
    document.getElementById("workshopsContainer").style.display = "block";
  });

  onSnapshot(workshopsRef, (snapshot) => {
    const container = document.getElementById('workshops');
    container.innerHTML = "";
    let i = 1;
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      if (data.hidden === true) return;
      const div = document.createElement('div');
      div.className = "workshop";
      div.innerHTML = `
        <h3>${i}. ${data.title}</h3>
        <p><strong>📅 التاريخ:</strong> ${data.date || ''}</p>
        <p><strong>⏰ الوقت:</strong> ${data.time || ''}</p>
        <ul>${Array.isArray(data.topics) ? data.topics.map(t => `<li>${t}</li>`).join("") : ''}</ul>
        <span class="available">متاح ✅</span><br>
        <button onclick="reserveWorkshop('${docSnap.id}')">حجز</button>
      `;
      container.appendChild(div);
      i++;
    });
  });

  window.reserveWorkshop = async function(id) {
    if (!registered || !currentUser) {
      alert("⚠️ يجب التسجيل أولاً قبل الحجز.");
      return;
    }
    const docRef = doc(db, "workshops", id);
    const snap = await getDoc(docRef);
    const data = snap.data();
    const existing = Array.isArray(data.requests) && data.requests.find(r => r.email === currentUser.email);
    if (existing) { alert("⚠️ سبق أن تقدمت لهذه الورشة."); return; }
    await updateDoc(docRef, { 
      requests: arrayUnion({
        name: currentUser.name, email: currentUser.email, phone: currentUser.phone,
        organization: currentUser.organization || '',
        workshopTitle: data.title || '', timestamp: new Date()
      })
    });
    alert("✅ تم تسجيل طلبك بنجاح.");
  };
</script>

</body>
</html>
